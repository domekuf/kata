/* This file was generated by ODB, object-relational mapping (ORM)
 * compiler for C++.
 */

DROP TABLE IF EXISTS "USER_FOLLOWED";

DROP TABLE IF EXISTS "USER_TIMELINE";

DROP TABLE IF EXISTS "USER";

DROP TABLE IF EXISTS "POST";

CREATE TABLE IF NOT EXISTS "schema_version" (
  "name" TEXT NOT NULL PRIMARY KEY,
  "version" INTEGER NOT NULL,
  "migration" INTEGER NOT NULL);

DELETE FROM "schema_version"
  WHERE "name" = 'kata';

CREATE TABLE "POST" (
  "KEY" INTEGER NULL PRIMARY KEY AUTOINCREMENT,
  "VERSION" INTEGER NULL,
  "CONTENT" TEXT NULL,
  "CREATED" INTEGER NULL);

CREATE TABLE "USER" (
  "KEY" INTEGER NULL PRIMARY KEY AUTOINCREMENT,
  "VERSION" INTEGER NULL,
  "NAME" TEXT NULL);

CREATE TABLE "USER_TIMELINE" (
  "OBJECT_ID" INTEGER NULL,
  "INDEX" INTEGER NULL,
  "VALUE" INTEGER NULL,
  CONSTRAINT "OBJECT_ID_FK"
    FOREIGN KEY ("OBJECT_ID")
    REFERENCES "USER" ("KEY")
    ON DELETE CASCADE,
  CONSTRAINT "VALUE_FK"
    FOREIGN KEY ("VALUE")
    REFERENCES "POST" ("KEY")
    DEFERRABLE INITIALLY DEFERRED);

CREATE INDEX "USER_TIMELINE_OBJECT_ID_IDX"
  ON "USER_TIMELINE" ("OBJECT_ID");

CREATE INDEX "USER_TIMELINE_INDEX_IDX"
  ON "USER_TIMELINE" ("INDEX");

CREATE TABLE "USER_FOLLOWED" (
  "OBJECT_ID" INTEGER NULL,
  "INDEX" INTEGER NULL,
  "VALUE" INTEGER NULL,
  CONSTRAINT "OBJECT_ID_FK"
    FOREIGN KEY ("OBJECT_ID")
    REFERENCES "USER" ("KEY")
    ON DELETE CASCADE,
  CONSTRAINT "VALUE_FK"
    FOREIGN KEY ("VALUE")
    REFERENCES "USER" ("KEY")
    DEFERRABLE INITIALLY DEFERRED);

CREATE INDEX "USER_FOLLOWED_OBJECT_ID_IDX"
  ON "USER_FOLLOWED" ("OBJECT_ID");

CREATE INDEX "USER_FOLLOWED_INDEX_IDX"
  ON "USER_FOLLOWED" ("INDEX");

INSERT OR IGNORE INTO "schema_version" (
  "name", "version", "migration")
  VALUES ('kata', 1, 0);

